import streamlit as st

# 1. CONFIGURACI칍N
st.set_page_config(page_title="DUSA - Calculadora de Alcohol", page_icon="游빍", layout="centered")

# CSS UNIFICADO (Din치mico para ambos modos)
st.markdown("""
   <style>
    .block-container {padding-top: 3.5rem; padding-bottom: 2rem;}
    [data-testid="stMetricValue"] {font-size: 1.8rem; font-weight: bold;}
    div[data-testid="stMetric"]:nth-child(1) [data-testid="stMetricValue"] {color: #2E86C1;} /* Azul para LAA */
    .fp-final {
        font-size: 1.05rem;
        color: #566573;
        margin-top: -10px;
        margin-bottom: 20px;
        font-weight: 500;
    }
    .header-container {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 1.5rem;
        padding: 10px;
        border-radius: 10px;
        background-color: #f8f9f9;
    }
    .titulo-mini { font-size: 0.75rem; margin: 0; text-transform: uppercase; font-weight: bold; color: #2E4053; }
    .subtitulo-mini { font-size: 1.1rem; margin: 0; color: #2E4053; font-weight: bold; }
    .autor-text { margin: 0; font-size: 0.9rem; color: #21618C; font-weight: 500; }
    
    .fp-final {
        font-size: 1.05rem;
        color: #566573;
        margin-top: 10px;
        font-weight: 500;
        border-top: 1px solid #eee;
        padding-top: 10px;
    }
    </style>
    """, unsafe_allow_html=True)

def obtener_fp(grado):
    # Tu matriz fiel de 501 valores
    puntos = {
        50.0: 1.0720, 50.1: 1.0723, 50.2: 1.0726, 50.3: 1.0729, 50.4: 1.0732, 50.5: 1.0735, 50.6: 1.0738, 50.7: 1.0741, 50.8: 1.0744, 50.9: 1.0747,
        51.0: 1.0750, 51.1: 1.0752, 51.2: 1.0754, 51.3: 1.0756, 51.4: 1.0758, 51.5: 1.0760, 51.6: 1.0762, 51.7: 1.0764, 51.8: 1.0766, 51.9: 1.0768,
        52.0: 1.0770, 52.1: 1.0772, 52.2: 1.0774, 52.3: 1.0776, 52.4: 1.0778, 52.5: 1.0780, 52.6: 1.0782, 52.7: 1.0784, 52.8: 1.0786, 52.9: 1.0788,
        53.0: 1.0790, 53.1: 1.0793, 53.2: 1.0796, 53.3: 1.0799, 53.4: 1.0802, 53.5: 1.0805, 53.6: 1.0808, 53.7: 1.0811, 53.8: 1.0814, 53.9: 1.0817,
        54.0: 1.0820, 54.1: 1.0822, 54.2: 1.0824, 54.3: 1.0826, 54.4: 1.0828, 54.5: 1.0830, 54.6: 1.0832, 54.7: 1.0834, 54.8: 1.0836, 54.9: 1.0838,
        55.0: 1.0840, 55.1: 1.0843, 55.2: 1.0846, 55.3: 1.0849, 55.4: 1.0852, 55.5: 1.0855, 55.6: 1.0858, 55.7: 1.0861, 55.8: 1.0864, 55.9: 1.0867,
        56.0: 1.0870, 56.1: 1.0872, 56.2: 1.0874, 56.3: 1.0876, 56.4: 1.0878, 56.5: 1.0880, 56.6: 1.0882, 56.7: 1.0884, 56.8: 1.0886, 56.9: 1.0888,
        57.0: 1.0890, 57.1: 1.0893, 57.2: 1.0896, 57.3: 1.0899, 57.4: 1.0902, 57.5: 1.0905, 57.6: 1.0908, 57.7: 1.0911, 57.8: 1.0914, 57.9: 1.0917,
        58.0: 1.0920, 58.1: 1.0922, 58.2: 1.0924, 58.3: 1.0926, 58.4: 1.0928, 58.5: 1.0930, 58.6: 1.0932, 58.7: 1.0934, 58.8: 1.0936, 58.9: 1.0938,
        59.0: 1.0940, 59.1: 1.0943, 59.2: 1.0946, 59.3: 1.0949, 59.4: 1.0952, 59.5: 1.0955, 59.6: 1.0958, 59.7: 1.0961, 59.8: 1.0964, 59.9: 1.0967,
        60.0: 1.0970, 60.1: 1.0973, 60.2: 1.0976, 60.3: 1.0979, 60.4: 1.0982, 60.5: 1.0985, 60.6: 1.0988, 60.7: 1.0991, 60.8: 1.0994, 60.9: 1.0997,
        61.0: 1.1000, 61.1: 1.1002, 61.2: 1.1004, 61.3: 1.1006, 61.4: 1.1008, 61.5: 1.1010, 61.6: 1.1012, 61.7: 1.1014, 61.8: 1.1016, 61.9: 1.1018,
        62.0: 1.1020, 62.1: 1.1023, 62.2: 1.1026, 62.3: 1.1029, 62.4: 1.1032, 62.5: 1.1035, 62.6: 1.1038, 62.7: 1.1041, 62.8: 1.1044, 62.9: 1.1047,
        63.0: 1.1050, 63.1: 1.1053, 63.2: 1.1056, 63.3: 1.1059, 63.4: 1.1062, 63.5: 1.1065, 63.6: 1.1068, 63.7: 1.1071, 63.8: 1.1074, 63.9: 1.1077,
        64.0: 1.1080, 64.1: 1.1083, 64.2: 1.1086, 64.3: 1.1089, 64.4: 1.1092, 64.5: 1.1095, 64.6: 1.1098, 64.7: 1.1101, 64.8: 1.1104, 64.9: 1.1107,
        65.0: 1.1110, 65.1: 1.1113, 65.2: 1.1116, 65.3: 1.1119, 65.4: 1.1122, 65.5: 1.1125, 65.6: 1.1128, 65.7: 1.1131, 65.8: 1.1134, 65.9: 1.1137,
        66.0: 1.1140, 66.1: 1.1142, 66.2: 1.1144, 66.3: 1.1146, 66.4: 1.1148, 66.5: 1.1150, 66.6: 1.1152, 66.7: 1.1154, 66.8: 1.1156, 66.9: 1.1158,
        67.0: 1.1160, 67.1: 1.1163, 67.2: 1.1166, 67.3: 1.1169, 67.4: 1.1172, 67.5: 1.1175, 67.6: 1.1178, 67.7: 1.1181, 67.8: 1.1184, 67.9: 1.1187,
        68.0: 1.1190, 68.1: 1.1193, 68.2: 1.1196, 68.3: 1.1199, 68.4: 1.1202, 68.5: 1.1205, 68.6: 1.1208, 68.7: 1.1211, 68.8: 1.1214, 68.9: 1.1217,
        69.0: 1.1220, 69.1: 1.1224, 69.2: 1.1228, 69.3: 1.1232, 69.4: 1.1236, 69.5: 1.1240, 69.6: 1.1244, 69.7: 1.1248, 69.8: 1.1252, 69.9: 1.1256,
        70.0: 1.1260, 70.1: 1.1263, 70.2: 1.1266, 70.3: 1.1269, 70.4: 1.1272, 70.5: 1.1275, 70.6: 1.1278, 70.7: 1.1281, 70.8: 1.1284, 70.9: 1.1287,
        71.0: 1.1290, 71.1: 1.1293, 71.2: 1.1296, 71.3: 1.1299, 71.4: 1.1302, 71.5: 1.1305, 71.6: 1.1308, 71.7: 1.1311, 71.8: 1.1314, 71.9: 1.1317,
        72.0: 1.1320, 72.1: 1.1323, 72.2: 1.1326, 72.3: 1.1329, 72.4: 1.1332, 72.5: 1.1335, 72.6: 1.1338, 72.7: 1.1341, 72.8: 1.1344, 72.9: 1.1347,
        73.0: 1.1350, 73.1: 1.1353, 73.2: 1.1356, 73.3: 1.1359, 73.4: 1.1362, 73.5: 1.1365, 73.6: 1.1368, 73.7: 1.1371, 73.8: 1.1374, 73.9: 1.1377,
        74.0: 1.1380, 74.1: 1.1384, 74.2: 1.1388, 74.3: 1.1392, 74.4: 1.1396, 74.5: 1.1400, 74.6: 1.1404, 74.7: 1.1408, 74.8: 1.1412, 74.9: 1.1416,
        75.0: 1.1420, 75.1: 1.1423, 75.2: 1.1426, 75.3: 1.1429, 75.4: 1.1432, 75.5: 1.1435, 75.6: 1.1438, 75.7: 1.1441, 75.8: 1.1444, 75.9: 1.1447,
        76.0: 1.1450, 76.1: 1.1454, 76.2: 1.1458, 76.3: 1.1462, 76.4: 1.1466, 76.5: 1.1470, 76.6: 1.1474, 76.7: 1.1478, 76.8: 1.1482, 76.9: 1.1486,
        77.0: 1.1490, 77.1: 1.1493, 77.2: 1.1496, 77.3: 1.1499, 77.4: 1.1502, 77.5: 1.1505, 77.6: 1.1508, 77.7: 1.1511, 77.8: 1.1514, 77.9: 1.1517,
        78.0: 1.1520, 78.1: 1.1524, 78.2: 1.1528, 78.3: 1.1532, 78.4: 1.1536, 78.5: 1.1540, 78.6: 1.1544, 78.7: 1.1548, 78.8: 1.1552, 78.9: 1.1556,
        79.0: 1.1560, 79.1: 1.1564, 79.2: 1.1568, 79.3: 1.1572, 79.4: 1.1576, 79.5: 1.1580, 79.6: 1.1584, 79.7: 1.1588, 79.8: 1.1592, 79.9: 1.1596,
        80.0: 1.1600, 80.1: 1.1603, 80.2: 1.1606, 80.3: 1.1609, 80.4: 1.1612, 80.5: 1.1615, 80.6: 1.1618, 80.7: 1.1621, 80.8: 1.1624, 80.9: 1.1627,
        81.0: 1.1630, 81.1: 1.1634, 81.2: 1.1638, 81.3: 1.1642, 81.4: 1.1646, 81.5: 1.1650, 81.6: 1.1654, 81.7: 1.1658, 81.8: 1.1662, 81.9: 1.1666,
        82.0: 1.1670, 82.1: 1.1674, 82.2: 1.1678, 82.3: 1.1682, 82.4: 1.1686, 82.5: 1.1690, 82.6: 1.1694, 82.7: 1.1698, 82.8: 1.1702, 82.9: 1.1706,
        83.0: 1.1710, 83.1: 1.1714, 83.2: 1.1718, 83.3: 1.1722, 83.4: 1.1726, 83.5: 1.1730, 83.6: 1.1734, 83.7: 1.1738, 83.8: 1.1742, 83.9: 1.1746,
        84.0: 1.1750, 84.1: 1.1754, 84.2: 1.1758, 84.3: 1.1762, 84.4: 1.1766, 84.5: 1.1770, 84.6: 1.1774, 84.7: 1.1778, 84.8: 1.1782, 84.9: 1.1786,
        85.0: 1.1790, 85.1: 1.1794, 85.2: 1.1798, 85.3: 1.1802, 85.4: 1.1806, 85.5: 1.1810, 85.6: 1.1814, 85.7: 1.1818, 85.8: 1.1822, 85.9: 1.1826,
        86.0: 1.1830, 86.1: 1.1834, 86.2: 1.1838, 86.3: 1.1842, 86.4: 1.1846, 86.5: 1.1850, 86.6: 1.1854, 86.7: 1.1858, 86.8: 1.1862, 86.9: 1.1866,
        87.0: 1.1870, 87.1: 1.1875, 87.2: 1.1880, 87.3: 1.1885, 87.4: 1.1890, 87.5: 1.1895, 87.6: 1.1900, 87.7: 1.1905, 87.8: 1.1910, 87.9: 1.1915,
        88.0: 1.1920, 88.1: 1.1924, 88.2: 1.1928, 88.3: 1.1932, 88.4: 1.1936, 88.5: 1.1940, 88.6: 1.1944, 88.7: 1.1948, 88.8: 1.1952, 88.9: 1.1956,
        89.0: 1.1960, 89.1: 1.1965, 89.2: 1.1970, 89.3: 1.1975, 89.4: 1.1980, 89.5: 1.1985, 89.6: 1.1990, 89.7: 1.1995, 89.8: 1.2000, 89.9: 1.2005,
        90.0: 1.2010, 90.1: 1.2015, 90.2: 1.2020, 90.3: 1.2025, 90.4: 1.2030, 90.5: 1.2035, 90.6: 1.2040, 90.7: 1.2045, 90.8: 1.2050, 90.9: 1.2055,
        91.0: 1.2060, 91.1: 1.2065, 91.2: 1.2070, 91.3: 1.2075, 91.4: 1.2080, 91.5: 1.2085, 91.6: 1.2090, 91.7: 1.2095, 91.8: 1.2100, 91.9: 1.2105,
        92.0: 1.2110, 92.1: 1.2115, 92.2: 1.2120, 92.3: 1.2125, 92.4: 1.2130, 92.5: 1.2135, 92.6: 1.2140, 92.7: 1.2145, 92.8: 1.2150, 92.9: 1.2155,
        93.0: 1.2160, 93.1: 1.2166, 93.2: 1.2172, 93.3: 1.2178, 93.4: 1.2184, 93.5: 1.2190, 93.6: 1.2196, 93.7: 1.2202, 93.8: 1.2208, 93.9: 1.2214,
        94.0: 1.2220, 94.1: 1.2226, 94.2: 1.2232, 94.3: 1.2238, 94.4: 1.2244, 94.5: 1.2250, 94.6: 1.2256, 94.7: 1.2262, 94.8: 1.2268, 94.9: 1.2274,
        95.0: 1.2280, 95.1: 1.2286, 95.2: 1.2292, 95.3: 1.2298, 95.4: 1.2304, 95.5: 1.2310, 95.6: 1.2316, 95.7: 1.2322, 95.8: 1.2328, 95.9: 1.2334,
        96.0: 1.2340, 96.1: 1.2346, 96.2: 1.2352, 96.3: 1.2358, 96.4: 1.2364, 96.5: 1.2370, 96.6: 1.2376, 96.7: 1.2382, 96.8: 1.2388, 96.9: 1.2394,
        97.0: 1.2400, 97.1: 1.2407, 97.2: 1.2414, 97.3: 1.2421, 97.4: 1.2428, 97.5: 1.2435, 97.6: 1.2442, 97.7: 1.2449, 97.8: 1.2456, 97.9: 1.2463,
        98.0: 1.2470, 98.1: 1.2477, 98.2: 1.2484, 98.3: 1.2491, 98.4: 1.2498, 98.5: 1.2505, 98.6: 1.2512, 98.7: 1.2519, 98.8: 1.2526, 98.9: 1.2533,
        99.0: 1.2540, 99.1: 1.2548, 99.2: 1.2556, 99.3: 1.2564, 99.4: 1.2572, 99.5: 1.2580, 99.6: 1.2588, 99.7: 1.2596, 99.8: 1.2604, 99.9: 1.2612,
        100.0: 1.2620
    }
    g_redondo = round(grado, 1)
    return puntos.get(g_redondo)

def formatear_numero(num, decimales=2):
    return "{:,}".format(round(num, decimales)).replace(',', 'X').replace('.', ',').replace('X', '.')

# ENCABEZADO UNIFICADO
URL_LOGO = "https://media.licdn.com/dms/image/v2/C4E0BAQGROeCPt2-5rQ/company-logo_200_200/company-logo_200_200/0/1630651014568/destileras_unidas_s_a_logo?e=2147483647&v=beta&t=4KCIm7iySF8w6uXTN9ISvF6zPFRGhe8L3MTN2oGJh34"

st.markdown(f"""
    <div class="header-container">
        <img src="{URL_LOGO}" width="60">
        <div>
            <p class="titulo-mini">Calculadora de Alcoholes</p>
            <p class="subtitulo-mini">Destiler칤as Unidas S.A.</p>
            <p class="autor-text">춸 Edwin Freitez</p>
        </div>
    </div>
    """, unsafe_allow_html=True)

# 2. SELECTOR DE MODO (Pesta침as)
tab1, tab2 = st.tabs(["游늵 Calcular Peso", "丘뒲잺 Calcular LAA"])

# --- MODO 1: NORMAL (LAA -> PESO) ---
with tab1:
    st.info("Utilice esta opci칩n para saber cu치nto se debe PESAR para el cami칩n o tanque.")
    c1, c2 = st.columns(2)
    with c1:

         grado_n = st.number_input("Grado Real (춿GL):", 50.0, 100.0, value=None, step=0.1, key="gn", format="%.1f", placeholder="0.0")
    with c2:
        laa_sol = st.number_input("LAA Solicitados:", min_value=0.0, value=None, step=0.1, key="laas", placeholder="Coloque los LAA")

    if st.button("CALCULAR PESO", use_container_width=True):
        if laa_sol and grado_n:
            fp = obtener_fp(grado_n)
            if fp:
                vol_bruto = (laa_sol * 100) / grado_n
                peso_kg = vol_bruto / fp
                
                # Mostrar resultados en Naranja (Color original)
                st.markdown('<p style="font-size: 18px; font-weight: bold; color: #2E86C1;">Resultados:</p>', unsafe_allow_html=True)
                st.metric(label="游뚵 PESO A CARGAR:", value=f"{formatear_numero(peso_kg)} Kg")
                st.metric(label="游늵 VOLUMEN REAL:", value=f"{formatear_numero(vol_bruto, 1)} Lts")
                st.markdown(f'<div class="fp-final">Factor de Peso: {fp:.4f}</div>', unsafe_allow_html=True)
            else:
                st.error("Grado fuera de rango.")
        else:
            st.warning("Ingrese 춿GL y los LAA")

# --- MODO 2: INVERSA (PESO -> LAA) ---
with tab2:
    st.info("Utilice esta opci칩n para determinar cu치ntos LAA hay en un peso registrado por Romana.")
    c1, c2 = st.columns(2)
    with c1:
        grado_i = st.number_input("Grado Real (춿GL):", 50.0, 100.0, value=None, step=0.1, key="gi", format="%.1f", placeholder="0.0")
    with c2:
        peso_r = st.number_input("Peso en Romana (Kg):", min_value=0.0, value=None, step=0.1, key="pr", placeholder="Coloque los Kg")

    if st.button("CALCULAR LAA", use_container_width=True):
        if peso_r and grado_i:
            fp = obtener_fp(grado_i)
            if fp:
                vol_real = peso_r * fp
                laa_res = (vol_real * grado_i) / 100
                
                # Mostrar resultados en Azul (Como pediste para la inversa)
                st.markdown('<p style="font-size: 18px; font-weight: bold; color: #2E86C1;">Resultados:</p>', unsafe_allow_html=True)
                st.write(f'<style>div[data-testid="stMetricValue"] {{color: #2E86C1;}}</style>', unsafe_allow_html=True)
                st.metric(label="游빍 LAA CALCULADOS:", value=f"{formatear_numero(laa_res)} LAA")
                st.metric(label="游늵 VOLUMEN REAL:", value=f"{formatear_numero(vol_real, 1)} Lts")
                st.markdown(f'<div class="fp-final">Factor de Peso: {fp:.4f}</div>', unsafe_allow_html=True)
            else:
                st.error("Grado fuera de rango.")
        else:
            st.warning("Ingrese 춿GL y Peso")
